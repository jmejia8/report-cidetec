\documentclass[12pt,letterpape]{article}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%       Paquetes Necesarios
\usepackage[left=2cm,right=2cm,top=2cm,bottom=2cm]{geometry}
\usepackage[utf8]{inputenc}
\usepackage[english]{babel}
\usepackage{amsmath, amsfonts, amssymb}
\usepackage{graphicx}
\usepackage{multirow}
\usepackage{algorithm, algpseudocode}

\title{Solving Engineering Problems using Physics-inspired Metaheuristic}
\author{Jesús-Adolfo Mejía-de-Dios
\\
{\bf Advisers:}\\
PhD. 
Efrén Mezura-Montes
and
PhD.
Edgar-Alfredo Portilla-Flores
}

\begin{document}
\maketitle

\begin{abstract}
	Physics-inspired Metaheuristic based on center of mass concept is used to solve
	engineering problems. A comparison against competitive evolutionary algorithm
	is made and the results obtained are promising, since this metaheuristic requires
	less evaluations of objective function.
\end{abstract}

\section{Introduction} % (fold)
\label{sec:introduction}

Metaheuristics have been successfully used for solving real-word problems \cite{easSurv}.
This kind of algorithms almost always outperform Mathematical Programming when problems
are highly non-linear and/or non-differentiable functions, large number of variables, 
among others \cite{problemas}. Most recently and important Metaheuristics can be divided in three
groups: Evolutionary Programming, Evolutionary Algorithms (EAs) and Physics-inspired
Algorithms \cite{biswas2013physics, easSurv, DBLP:journals/corr/FisterYFBF13,spall03}.\\

Physical metaphors ideas are used to construct metaheuristics optimization problems
for example: Gravitational  Search Algorithm (GSA) \cite{rashedi2009gsa}, 
Gravitational Local Search (GLSA) \cite{glsa}, Big-Bang Big-Crunch (BBBC) \cite{erol2006new}, 
Charged System Search (CSS) \cite{kaveh2010novel}, Central Force Optimization 
(CFO) \cite{cfo2007}, Black Hole (BH) \cite{hatamlou2013black} algorithm, and Ray 
Optimization (RO) algorithm \cite{kaveh2012new}, among others. Some recent surveys 
on this topic can be found in
\cite{fisicaSurvey,biswas2013physics,DBLP:journals/corr/FisterYFBF13,xie2011convergence}. \\

Thus, it is important to know how metaheuristic behave in real-word problems.
In this work numerical constrained optimization problems (CNOP) are considered,
without loss of generality, a CNOP can be defined as to:\\

\noindent
Minimize:
\begin{equation}
	f(\vec{x}),\ \vec{x}  \in S \subset \mathbb{R}^D
	\label{eqn:fx}
\end{equation}
%
subject to:
\begin{align*}
	g_i(\vec{x}) &\leq 0,& i =&  1 , \ldots, p \\
	h_j(\vec{x}) &= 0,& j =& p+1, \ldots, m
\end{align*}
%
where $S = \prod_{k = 1}^D  [ x_{k,\min},\ x_{k,\max} ]$ i.e. $x_k \in [ x_{k,\min},\ x_{k,\max} ]$ 
for $k = 1,2,\ldots,D$. The problem is subject to $p$ inequality constraints and 
$m - p$ equality constraints. If $\vec{x}$ satisfies $g_i( \vec{x} ) \leq 0$, for 
$i = 1, \ldots, p$ and $|h_j(\vec{x})| \leq \varepsilon$, for $j = p+1, \ldots, m$ 
with $\varepsilon > 0$ a small value; then $\vec{x}$ is regarded feasible.\\


The following Section \ref{sec:eca} describes the metaheuristic based on center
of mass concept. Section \ref{sec:synthesis_of_four_bar_mechanisms} explains the
general synthesis of a four-bar mechanism and three representative study cases.
Section \ref{sec:control} presents the coupled dynamics of the four-bar mechanism
with DC motor. Finally, the conclusions are given in Section \ref{sec:conclusion_and_future_work}.
% section introduction (end)

% 
\section{Evolutionary Centers Algorithm} % (fold)
\label{sec:eca}

This approach is based on the center of mass definition, which is adopted for 
creating new directions and generate a bias in the population, and such bias is 
based on the objective function values of the solutions in the population. The 
selection criteria are modified to consider feasibility of solutions. Therefore, 
the aim of the algorithm will be generating solutions within the feasible region 
of the search space but with competitive objective function values.

%
%
\subsection{Motivation} % (fold)
The motivation of ECA is two-fold: (1) the meaning of the center of mass, and (2) 
the way EAs, swarm intelligence and other physics-based algorithms generate new 
solutions in the search space. 
% 
\begin{enumerate}
	\item The center of mass is a geometric property of any body. From a particular 
		  point of view, it is the average location of the weight of an object. 
		  In fact, it is possible to describe the motion of an object through 
		  space, based on the movement of its center of mass from one particular 
		  place to another. In such way, the population can be moved to places 
		  where the center of mass is maximized. 
	% 
	\item The way population-based approaches, like most of those mentioned in 
		  Section \ref{sec:introduction}, generate new solutions is based on 
		  Equation \ref{eqn:xxv}, where $\vec{x}_{i + 1}$ is the new solution 
		  generated by the current solution $\vec{x}_{i}$ and some update 
		  information $\vec{v}_{i + 1}$. 
\end{enumerate}
\begin{equation}
	\vec{x}_{i + 1} = \vec{x}_{i} + \vec{v}_{i + 1}
	\label{eqn:xxv}
\end{equation}
% 

Formally, the center of mass is the unique point $\vec{c}$ at the center of a 
distribution of mass $U = \{\vec{u}_1,\; \vec{u}_2 , \ldots , \vec{u}_K \}$ in a 
space with the the property that the weighted sum of position vectors relative 
to this point is zero \cite{kleppner73,serway}, as shown in Equation \ref{eq:masscenter}:
%
%
\begin{equation}
	\sum_{i = 1}^K m(\vec{u}_i) (\vec{u}_i - \vec{c}) = 0, \text{ implies } 
	%%%%%%%%%%%%%%%%%%%%%
	\vec{c} = \dfrac{1}{M} \sum_{i = 1}^K  m(\vec{u}_i)  \vec{u}_i,
	\label{eq:masscenter}
\end{equation}
%
%
where $m(\vec{u}_i)$ is the mass of $\vec{u}_i$ and  $M$ is the sum of the 
masses of vectors in $U$, and $m$ is a non-negative function.\\


For ECA, the objective function value of a given solution represents
its mass, then each solution in the population has a mass value associated,  i.e., 
we set $f(\vec{x}) = m(\vec{x})$ for all $\mathbb{R}^D$. Without loss of generality, 
it is assumed the maximization of a non-negative function $f$. 
Theoretically, this approach (ECA) use this name, since satisfy the definition of
Evolutionary Algorithm \cite{back}.


\subsection{Variation Operator} % (fold)
\label{sub:algorithm_description}

The variation operator used in ECA, inspired in the center of mass, works as follows: 
for each solution $\vec{x}_i $ in the population $P = \{ \vec{x}_1, \vec{x}_2, \ldots, \vec{x}_{N} \} $ of $N$ 
solutions, a subset $U \subset P $ with $K$ solutions is randomly chosen. After 
that, from $U$ the center of mass $\vec{c}$ is computed; then based on  a solution 
chosen at random $\vec{u}_r \in U$, a stepsize $\eta$, and the already generated 
center of mass $\vec{c}$, a search direction to locate a new solution $ \vec{y}_i$ 
is calculated. Such process is summarized in Equation \ref{eqn:vcu}:

\begin{equation}
	\vec{y}_i = \vec{x}_i + \eta ( \vec{c}_i - \vec{u}_{r} ),
	\label{eqn:vcu}
\end{equation}
%
where 
%
\begin{equation}
	\vec{c}_i = \dfrac{1} {W} \sum_{u \in U} f(\vec{u}) \cdot \vec{u} , 
			\hspace{0.5cm} 
			W = \sum_{ \vec{u} \in U} f(\vec{u}).
	\label{eqn:center}
\end{equation}

It is worth mentioning that the variation operator in Equation \ref{eqn:vcu} 
provides a bias to the most promising solutions, but also considers the position 
of the other solutions in $U$, as depicted in  Figure \ref{fig:masses}. 

\begin{figure}[!ht]
	\centering
	\includegraphics[width=7cm]{img/masses.pdf}
	\caption{$c_m$ is center of mass, $c_g$ is geometric center of gray points. %
	Gray point radius is its mass. Note the bias given by the weighted sum.}
	\label{fig:masses}       % Give a unique label
\end{figure}
%
%
The bias is precisely given by Equation (\ref{eqn:center}) because for a solution 
with the highest mass, the position of the center of mass is near  
its position. It is then important to remark that this bias is constraint-independent, i.e., 
no feasibility information is used in the variation operator.

\subsection{Some Considerations} % (fold)
\label{sub:some_considerations}


For each solution $\vec{x}_i $ in the population 
$P = \{ \vec{x}_1, \vec{x}_2, \ldots, \vec{x}_{N} \} $ of $N$ 
solutions, we select $U \subset P $ with $K$ \textbf{different} solutions. Next, 
from $U$ we obtain the center of mass $\vec{c}$. After that, \textbf{we choose the solution}
$\vec{u}_{\text{worst}} \in U$, and the already generated center of mass $\vec{c}$,
we generate a direction to locate a new solution $ \vec{h}_i$. Using a binomial 
crossover, generate a new solution $\vec{h}_{i}$ with coordinates

%
\begin{equation}
	\vec{h}_{i,j} = 
	\begin{cases}
		y_{i,j} & \text{ if rand()} < P_{\text{bin}}\\
		c_{i,j} & \text{ otherwise}
	\end{cases}
	\label{eqn:newSol}
\end{equation}
% 
for $j = 1,2,\ldots,D$. With 
%
\begin{equation}
	\vec{y}_i = 
	\begin{cases}
		\vec{x}_i + \eta _{i} ( \vec{c}_i - \vec{u}_{ \text{worst} } ) 
		       & \text{ if } P_{\text{evals}} < P_{\text{exploit}} \\
		% 
		\vec{x}_i + \eta _{i} ( x_{\text{best}} - \vec{c}_i)
		       & \text{ otherwise}
	\end{cases}
	\label{eqn:vcu2}
\end{equation}
%
here, $ P_{\text{evals}}$ is the evaluation ratio (current number of function evaluation / max.
number of function evaluations) and  $P_{\text{exploit}}$ is the last percentage of
evaluations used for an exploitation process.\\
%


\subsubsection{Why Binomial Crossover?} % (fold)
\label{sub:why_binomial_crossover_}

Suppose you are using ECA without binomial crossover for optimizing a function 
$f:\mathbb{R}^D \to \mathbb{R}$ and you initialize the entire population in a 
plain $V \subset \mathbb{R}^D $ such that $0 \in V$. This plain $V$ is a vector 
subspace of $\mathbb{R}^D$, i.e. any linear combination of vectors in $V$ is in V.\\

Now, let $T:V^3 \to V$ be a linear transformation defined as 
$ T(\vec{x},\ \vec{c},\ \vec{u}) = \vec{x} + \eta ( \vec{c} - \vec{u} )$ where 
$c,x,u \in V$. Assume $x_\text{best} = \arg \max f(x)$ such that $x_\text{best} $
is not in $V$. Here, ECA can not reach $x_\text{best}$ because ECA only generate
solution in $V$. Although, ECA without crossover can not generate solutions outside $V$.

% section eca (end)

\subsection{Constraints Handling} % (fold)
\label{sub:constraints_handling}

\begin{algorithm}[!ht]
	\caption{ECA pseudocode}
	\label{algoritmoEca}
	\begin{algorithmic}[1]
		\Procedure{ECA}{$K = 7, \; \eta_{\max} = 4,\ P_{\text{exploit}} = 0.95,\ P_{\text{bin}} = 0.7,\ \alpha = 100$}
		\State $N \gets K * D$
		\State Generate and evaluate start population $P$ with $N$ elements
		\While{the end criterion is not achieved}
			\For {each $\vec{x}$ in $P$}
				\State Generate a subset $U \subset P$ such that  card$(U) = K$
				\State Calculate $\vec{c}$ using $U$ with (\ref{eqn:center})
				\State $\eta \gets \text{rand}(0,\; \eta_{\max}) $ 
				\State Calculate $\vec{h}$ using Eq. (\ref{eqn:newSol})
				
				\If{$ \Phi (\vec{x}; \alpha) < \Phi (\vec{h}; \alpha)  $}
					\State Replace worst element in $P$ with $\vec{h}$
				\EndIf
			\EndFor
		\EndWhile
		\State Report best solution in $P$
		\EndProcedure
	\end{algorithmic}
\end{algorithm}


\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.35\linewidth]{img/ecaG.pdf}
	\caption{Schematic diagram representing a generation of ECA. Gray points % 
	represent elements in $U$. Gray area is representing the feasible region.}
	\label{fig:ecag}       % Give a unique label
\end{figure}

As we can see, ECA is designed to solve single-objective real-parametric optimization.
Then, we need propose a method for constraints handling. We suggest use a penalty
method, that is:
% 
\begin{equation}
	\Phi( \vec{p} ;\ \alpha ) = f( \vec{p} ) + \alpha \sum_{i=1}^{n+9} G(g_i( \vec{p} ) ),
% 
	\label{eqn:phiObj}
% 
\end{equation}
where 
$$
G(x) = 
\begin{cases}
	\displaystyle
	x & \text{ if } x > 0 \\
	0 & \text{ otherwise. }
\end{cases}
$$
% 
% 
% 
Algorithm \ref{algoritmoEca} is the general pseudocode of ECA and Figure \ref{fig:ecag}
shows a representation of ECA solution update. 
% 
Next section presents the general
synthesis of a four-bar mechanism is explained.
% 
% 

\section{Synthesis of Four-Bar Mechanisms} % (fold)
\label{sec:synthesis_of_four_bar_mechanisms}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.5\linewidth]{img/four-bars.pdf}
	\caption{Four-Bar mechanism diagram.}
	\label{fig:fourbar}
\end{figure}

This section is based on work of Hern{\'a}ndez-Oca{\~n}a et al \cite{hernandez2016}.
Four-bar mechanisms are formed by a references bar, input bar (crank), a coupler
and a out bar (rocker). The simplicity of four-bar mechanisms provide many facilities
for a large number of industrial applications \cite{david2005, mccarthy6, toussaint3}.
Actually, the kinematics of this kind of planar mechanisms have been extensively
worked. A good idea it is transform from planar to coordinates coordinates, i.e.

\begin{equation}
	\vec{r}_k = r_k ( \cos(\theta_k) + i \sin( \theta_k ) ) \ \text{ for } \ k = 1,2,3,4.
	\label{eqn:rpolar}
\end{equation}

\subsection{Kinematics of The Mechanism} % (fold)
\label{sub:kinematics_of_the_mechanism}

To analyze the mechanism position, the closed loop equation can be established as follows:

\begin{equation}
	\vec{r}_1 + \vec{r}_4 = \vec{r}_2 + \vec{r}_3.
	\label{eqn:sumsr}
\end{equation}

From Equations (\ref{eqn:rpolar}) and  (\ref{eqn:sumsr}) we obtain the following system:
\begin{equation}
	\begin{cases}	
	 	r_1\cos\theta_1 + r_4\cos\theta_4 = r_2\cos\theta_2 + r_3\cos\theta_3 \\
	 	r_1\sin\theta_1 + r_4\sin\theta_4 = r_2\sin\theta_2 + r_3\sin\theta_3 
	\end{cases}
	\text{ implies } 
	\label{eqn:systemr}
\end{equation}
% 
Expressing the equation system (\ref{eqn:systemr}) in terms of $\vec{r}_4$
% 
\begin{equation}
	\begin{cases}	
	 	r_4\cos\theta_4 = r_2\cos\theta_2 + r_3\cos\theta_3 - r_1\cos\theta_1\\
	 	r_4\sin\theta_4 = r_2\sin\theta_2 + r_3\sin\theta_3 - r_1\sin\theta_1
	\end{cases}
	\label{eqn:systemr4}
\end{equation}
% 
% Squaring the system (\ref{eqn:systemr4}) and adding its terms we obtain:
% 
\begin{equation}
	a \cos \theta_3 + b\sin\theta_3 + c = 0,
\end{equation}
% 
where
% 
\begin{align*}
	a &= 2r_3 ( r_2\cos\theta_2 - r_1\cos\theta_1 ),\\
	b &= 2r_3 ( r_2\sin\theta_2 - r_1\sin\theta_1 ),\\
	c &= r_1^2 + r_2^2 + r_3^2 - r_4^2 - 2r_1 r_2 \cos( \theta_1 - \theta_2 ).
\end{align*}
% 
Then, the angle $\theta_3$ can be calculated as a function with parameters $a, b, c$
and $\theta_3$, and $\cos\theta_3$ in terms of $\tan (\theta_3 / 2)$:
%
\begin{align}
 	\sin \theta_3 &= \dfrac{2\tan(\theta_3 / 2)}{1 + \tan^2(\theta_3 / 2)}\\
 	\sin \theta_3 &= \dfrac{ - \tan^2(\theta_3 / 2)}{1 + \tan^2(\theta_3 / 2)}
\end{align}
%
A second-order lineal equation is obtained by substitution on
\begin{equation}
	[c - a]\tan^2(\theta_3 / 2) + 2b\tan(\theta_3 / 2) + a + c = 0
	\label{eqn:subs}
\end{equation}
% 
From the solution of (\ref{eqn:subs}), the angular position $\theta_3$ is given by:
\begin{equation}
	\theta_3 = 2\arctan \left[ \dfrac{-B\pm \sqrt{b^2 - 4ac} }{c-a} \right].
	\label{eqn:theta3}
\end{equation}
% 
Analogously, we can get $\theta_4$.

% section kinematics_of_the_coupler (end)
\subsection{Kinematics of the Coupler} % (fold)
\label{sec:kinematics_of_the_coupler}
Since the point of interest in the coupler is $C(C_{xr}, C_{yr})$, to determine
its position in the reference system $OX_r Y_r$ it has to be established that
\begin{align}
	C_{xr} &= r_2 \cos\theta_2 + r_{cx}\cos\theta_3 - r_{cy}\sin\theta_3,\\
	C_{yr} &= r_2 \sin\theta_2 + r_{cx}\sin\theta_3 - r_{cy}\cos\theta_3,
\end{align}
In the global coordinate system, this point is expressed as:
\begin{equation}
	\begin{bmatrix}
		C_x \\ C_y
	\end{bmatrix}
	=
	\begin{bmatrix}
		\cos\theta_0 & -\sin\theta_0\\
		\sin\theta_0 & -\cos\theta_0\\
	\end{bmatrix}
	\begin{bmatrix}
		C_{xr} \\ C_{yr}
	\end{bmatrix}
	+\begin{bmatrix}
		x_0 \\ y_0
	\end{bmatrix}.
	\label{eqn:cxr}
\end{equation}
Equations (\ref{eqn:theta3}) and (\ref{eqn:cxr}) and the expressions from the
kinematics of the mechanism are sufficient to calculate the position of
$C$ along the trajectory.

\subsection{Design Objective Function} % (fold)

In order to find the best mechanism such that the trajectory corresponds to $n$
precision points, we quantify the error using quadratic error. Let 
$M = \{ C^i_d \in \mathbb{R}^2 \ | \ i =1,2\ldots,n \}$ be a set of precision points.

Then, given the parameters of a mechanism, each point of the coupler can be
expressed as a function of the input bar position

$$
 C^i = [ C_x(\theta_2^i),\ C_y(\theta_2^i)]^T
$$

Now, it is desired to minimize the error between each precision point $C^i_d$ and
the calculated point $C^i$, respectively. Thus, the error is calculated using the
expression:

$$
	\text{error} = \sum_{i=1}^n \left[ (C_{xd}^i - C_x^i) + C_{yd}^i - C_y^i) \right]. 
$$

% 
\subsection{Design Constraints} % (fold)
\label{sub:design_constraints}
It is important add some constraints to grantee the movement criteria and restrict
the size and shape of me mechanism. Here is where the Grashof's Law takes place:\\

Grashof's Law establishes that for a planar four-bar linkage, the sum of the shortest
and the largest bars cannot be larger than the sum of the remaining bars, if a
continual relative rotation between two elements is desired \cite{david2005}. \\

Hence, applying the Grashof's Law to our problem, we obtain
$$
r_1 + r_2 \leq r_3 + r_4.
$$
% 
Now, we need a Crank-rocker mechanism. Thus, for ensure the solution method, the
following constraints were established:
$$
r_2 < r_3, \ r_3 < r_4, \ \text{ and } \ r_4 < r_1.
$$

On the other hand, the angle sequence $\theta_2^1,\ \ldots,\ \theta_2^n,\ $ must
satisfy $ \theta_2^1 < \theta_2^2 <\ \cdots < \ \theta_2^n,\ $ because we are
assuming successive precision points.

\subsection{Experiments Design} % (fold)
\label{sec:experiments_design}

Experiments details are detailed here. The vector of design variables is

\begin{equation}
	\vec{p} = ( r_1,\ r_2,\ r_3,\ r_4,\ r_{cx},\ r_{cy},\ x_0,\ y_0,\ \theta_0,\ \theta_2^1,\ \theta_2^2,\ \ldots,\ \theta_2^n  ) \in S \subset \mathbb{R}^{9+n},
	\label{eqn:desigVars}
\end{equation}
% 
where the search space is $S = [0,\ 60]^4 \times [-60,\ 60]^4 \times [0,\ 2\pi ]^{n+1} $, i.e. each boundary is:
% 
% 
\begin{align*}
       r_1,\ r_2,\ r_3,\ r_4 & \in [0,\ 60]\\
 r_{cx},\ r_{cy},\ x_0,\ y_0 & \in [-60, 60]\\	
\theta_0,\ \theta_2^1,\ \ldots,\ \theta_2^n &\in [0, 2\pi].
\end{align*}
% 
Here, $r_1,\ \ldots,\ r_4$ correspond to the lengths of the bars. $(r_{cx},\ r_{cy})$
is the position of the coupler. $O_2(x_0,\ y_0)$ is the coordinate position,
$\theta_0$ is the orientation angle of the system with respect to the horizontal.
Finally, $\theta_2^1,\ \ldots,\ \theta_2^n$ are angle values of the input bar $r_2$.\\
% 

Based on mentioned above, construct a four-bar crank-rocker mechanism is equivalent
to solve the following constrained optimization problem:
% 
\begin{align}
	\min f(\vec{p}) = \sum_{i=1}^n \left[ (C_{xd}^i - C_x^i) + C_{yd}^i - C_y^i) \right].
	\label{eqn:objfun1}
\end{align}
% 
subject to: 
% 
\begin{align}
 \label{eqn:g1}
 g_1( \vec{p})  & = r_1 + r_2 - r_3 - r_4 \\
 g_j(\vec{p})   & = r_j -  r_{j+1} \leq 0, \text{ for } j = 2, 3 \\
 \label{eqn:g4}
 g_4(\vec{p})   & = r_4 - r_1 \\
 g_{4 + j } (\vec{p})   & = \theta_{2}^j - \theta_{2}^{j+1} \leq 0,  \text{ for } j = 1, \ldots, n-1.
 \label{eqn:COPtheta} 
\end{align}
%

Next Section presents three study cases and how they are solved using the Algorithm
\ref{algoritmoEca}.

\subsection{Study Cases} % (fold)
\label{sub:study_cases}

Three study cases are presented here. Each case consists $n$ precision points which
we need obtain a four-bar mechanism such that the coupler pass through them. Figure
\ref{fig:studycases} shows the point distribution for each case.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.9\linewidth]{img/study-cases.pdf}
	\caption{Distribution of each precision points. Three study cases are considered.}
	\label{fig:studycases}
\end{figure}

\begin{itemize}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%%%%%%%%%%%%%%%%%%%%%%%%%%%%
\item[M01.] It is the design of a four-bar mechanism that follows a linear vertical path
defined by a sequence of six precision points, without a previously established
synchronization. The set of precision points is defined as
% 
$$
	M_{1} = \{ (20, 20),\ (20, 25),\ (20, 30),\ (20, 35),\ (20, 40),\ (20, 45) \}
$$
The vector of design variables (\ref{eqn:desigVars}) becomes $ \vec{p} \in \mathbb{R}^{15} $, since $|M| = 6$. 
%
%
\item[M02.] The second study case is the design of a four-bar mechanism that follows
a trajectory generated by precision points. Here, the values of angles are known.
That is,
% 
$$
	M_{2} = \{(3, 3),\ (2.759,\ 3.363),\ (2.372,\ 3.663),\ (1.890,\ 3.862),\ (1.355, 3.943) \}
$$
% 
at respective angles of crank:
$$
	\theta_2^i = \dfrac{2\pi}{12}, \dfrac{3\pi}{12}, \ldots,\dfrac{6\pi}{12}.
$$
% 
Also, $x_0, y_0, \theta_0 = 0$. Hence, the design variables is $\vec{p} \in \mathbb{R}^6$.
Here, we have only four constraints $g_1(\vec{p}), \ldots, g_4(\vec{p})$ in the
COP (\ref{eqn:objfun1})-(\ref{eqn:g4}).


% 


\item[M03.] This case considers a sequence of ten pairs of precision points:
The vector of design variables is $ \vec{p} \in \mathbb{R}^{19} $. Here, the coupler
must adjust a trajectory to each par simultaneously.

\begin{table}[!ht]
	\centering
	\begin{tabular}{ccc}
			\hline
			Pair  &    $M_{3}^1$    &    $M_{3}^2$      \\
			\hline
			1 & (1.768, 2.3311) & (1.9592, 2.44973) \\
			2 & (1.947, 2.6271) & (2.168, 2.675)    \\
			3 & (1.595, 2.7951) & (1.821, 2.804)    \\
			4 & (1.019, 2.7241) & (1.244, 2.720)    \\
			5 & (0.479, 2.4281) & (0.705, 2.437)    \\
			6 & (0.126, 2.0521) & (0.346, 2.104)    \\
			7 & (-0.001, 1.720) & (0.195, 1.833)    \\
			8 & (0.103, 1.514)  & (0.356, 1.680)    \\
			9 & (0.442, 1.549)  & (0.558, 1.742)    \\
		   10 & (1.055, 1.905)  & (1.186, 2.088)    \\
			\hline
	\end{tabular}
	\caption{Pairs of precision points for case study 3.}
\end{table}
In this case, we need to modify the objective function:
\begin{align}
	f(\vec{p}) &= \sum_{i=1}^n \left[ (C_{xd}^i - C_x^i) + C_{yd}^i - C_y^i) \right]
	+ \sum_{i=1}^n \left[ (C_{2xd}^i - C_x^i) + C_{2yd}^i - C_y^i) \right],
	\label{eqn:objfun2}
\end{align}
with $(C_{xd}^i,\ C_{yd}^i) \in M_3^1 $ and $(C_{2xd}^i,\ C_{2yd}^i) \in M_3^2 $.
Thus, the optimization problem for this cased is given by (\ref{eqn:objfun2}) and
 (\ref{eqn:g1})--(\ref{eqn:COPtheta}).

\end{itemize}

% subsection study_cases (end)

\subsection{Results and Discussion} % (fold)
\label{sec:results1}

\begin{table}[!ht]
	\centering
	\begin{tabular}{clrccccc}
		\hline
		 & {\bf Alg.} & {\bf Evals}.  & {\bf Best} & {\bf Median} & {\bf Mean} & {\bf Std.} \\ \hline
		 % 
		% --------------------------------------------------------------------------
		\multirow{2}{*}{M01}
		& ECA & 300000  & 0.000000E+00  & 3.455233E--04 & 4.449034E--04 & 7.345703E--04 &
		\multirow{2}{*}{$ \approx $}\\  
		& ED  & 750000  & 7.573065E--29 & 1.328421E--05 & 2.601458E--03 & 7.588249E--03 &  \\ \hline
		% 
		% --------------------------------------------------------------------------
		\multirow{2}{*}{M02}
		& ECA &  60000  & 2.628079E--03 & 2.628079E--03 & 2.628079E--03 & 4.408496E--19 & 
		\multirow{2}{*}{$ \approx $}\\ 
		& ED  & 100000  & 2.628079E--03 & 2.628079E--03 & 2.628079E--03 & 6.736261E--18 &  \\ \hline
		% 
		% --------------------------------------------------------------------------
		\multirow{2}{*}{M03}
		& ECA & 380000  & 2.749687E--01 & 2.783940E--01 & 3.755563E--01 & 2.502182E--01 & 
		\multirow{2}{*}{$ \approx $}\\ 
		& ED  & 500000  & 2.749687E--01 & 2.773593E--01 & 7.610914E--01 & 1.116940E+00  &  \\ \hline
		% --------------------------------------------------------------------------
	\end{tabular}
	\caption{Here, ``$\approx$'' means no difference was observed, based on a Wilcoxon
	signed rank sum test with a level of significance $\alpha = 0.05$. Also, the
	feasibility ratio is 100\%.}
	\label{eqn:statRes}
\end{table}

Algorithm \ref{algoritmoEca} was used for solving the three four bar-mechanism
synthesis design problems detailed above. ECA was coded in Julia 0.6 and executed
on a PC with a Core i5 and 8GB of RAM, and 64 bits Linux Mint 18 operating system.
The set of parameters for ECA for each case are presented in the Table \ref{tab:parms}.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.3\linewidth]{img/m1.pdf}
	\includegraphics[width=0.3\linewidth]{img/m2.pdf}
	\includegraphics[width=0.3\linewidth]{img/m3.pdf}
	\caption{Mechanisms provided by ECA. From mechanical point of view, this designs
	are good, since the trajectory of M01 and M02 pass over the precision points.}
	\label{fig:optimalM}
\end{figure}

\begin{table}[!ht]
	\centering
	\begin{tabular}{cccccc}
		    & Max. Evals. & $\eta_{\max}$ & $K$ & $N$ & Constraints \\ \hline
		M01 &   300000    &     2         &  3  & 100 & 10\\
		M02 &    60000    &     2         &  7  & 42  & 4 \\
		M03 &   350000    &     3         &  7  & 200 & 14\\
	\end{tabular}
	\caption{Parameters of Algorithm \ref{algoritmoEca}. First column is the number
	of study case. $\eta_{\max}$, $K$ and $N$ are the stepsize, $K$-value and the
	population size, respectively.}
	\label{tab:parms}
\end{table}

The statistical results obtained by Algorithm \ref{algoritmoEca} are reported in
Table \ref{eqn:statRes}. Furthermore, we compared ECA against a variant of differential
evolution \cite{ed1995} which is a competitive evolutionary algorithm designed for solving
optimal four-bar synthesis \cite{hernandez2016}. As we can see, ECA, based on the 95\%-confidence
Wilcoxon Rank-Sum test, ECA reached similar results in the three problems but with
less evaluations of objective function. As we can see in Figure \ref{fig:convMedian1},
our approach was able to converge fast in the threes cases.
% which can be suitable for computationally-expensive real-world optimization problems.
Figure \ref{fig:optimalM} shows the best mechanism found by Algorithm \ref{algoritmoEca}.

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.95\linewidth]{img/convergence_1.pdf}
	\caption{Convergence at median. ECA provides fast convergence in three the study cases.}
	\label{fig:convMedian1}
\end{figure}



% \begin{table}[!ht]
% 	\centering
% 	\begin{tabular}{|c|c|}
% 		\hline
% 		    & p-value \\ \hline
% 		M01 & 0.85  \\ \hline
% 		M02 & 1 \\ \hline
% 		M03 & 0.28\\ \hline
		
% 	\end{tabular}
% \end{table}

\section{Control of a Four-Bar Mechanism with Spring and Damping Forces.} % (fold)
\label{sec:control}

In the preview Section, the main assumption considers that the angular velocity
of the actuator is constants but this is not always fulfilled, if an electric motor
drives the crank. For example, center of mass of FBM may move when the crank rotates.
Also, the angular velocity of the crank is not constant when the inertia of the 
FBM yields an external load to the motor. Thus, we need a control system that grantee 
an uniform an efficient regulation of the angular velocity.

\subsection{Dynamic Model} % (fold)
\label{sub:dynamic_model}

\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.8\linewidth]{img/four-bar-spring.pdf}
	\caption{Representation of a four-Bar mechanism with spring and damping forces.}
\end{figure}

The four-bar mechanism with spring and damping forces (FBM-SDF) has one degree of
freedom (DoF) in the crank. This DoF is actuated by a DC motor. Here, the $i-$th
link is represented by its mass $m_i$, inertia $J_i$, length $L_i$, center of mass
length $r_i$ and center of mass angle $\phi_i$. The angle of $i-$th link with
respect to the base reference $(X, Y)$ is set as $\theta_i$. Here, $k$ and $C$
are the constant of the spring and the damping coefficient of the damper, respectively.\\

Angular velocity $\dot{\theta}_i$, $ i = 2,3,4$ and the linear velocity $v_{ix},v_{iy}$
of the center of mass of the $i-th$ link with respect to the inertial frame.

\begin{align}
	\dot{ \theta } &= \gamma_i \dot{\theta}_2\\
	v_{ix} &= \alpha_i \dot{\theta}_2\\
	v_{iy} &= \beta_i \dot{\theta}_2,
\end{align}
% 
where
\begin{align}
	\alpha_2 &= -r_2\sin( \theta_2 + \phi_2 )\\
	\alpha_3 &= -L_2\sin\theta_2  -r_3 \gamma_3 \sin(\theta_3 + \phi_3)  \\
	\alpha_4 &= -r_4 \gamma_4 \sin( \theta_4 + \phi_4 ) \\
	% 
	\beta_2 &= r_2 \cos(\theta_2 + \phi_2) \\
	\beta_3 &= L_2 \cos\theta_2 - r_2 \gamma_3 \cos( \theta_2 + \phi_3 ) \\
	\beta_4 &= -r_4 \gamma_4 \cos(\theta_4 + \phi_4) \\
	% 
	\gamma_2 &= 1 \\
	\gamma_3 &= \dfrac{L_2 \sin( \theta_4 - \theta_2 ) }{L_3 \sin( \theta_3 - \theta_4 ) } \\
	\gamma_4 &= \dfrac{L_2 \sin( \theta_3 - \theta_2 ) }{L_3 \sin( \theta_3 - \theta_4 ) }. \\
\end{align}
% 
Defining the Lagrangian function $\tilde{L}$, where $K$ and $P$ is the kinematic
and potential energy, respectively:
$$
	\tilde{L} = K- P,
$$
% 
where
%
\begin{align}
	K &= \sum_{i=2}^4  \left( \dfrac{1}{2} m_i ( v^2_{ix} + v^2_{iy} )
		+ \dfrac{1}{2} J_i \dot{ \theta_i^2 }  \right) = \dfrac{1}{2} A(\theta_2) \dot{\theta}_2^2  \\
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
	P &= \dfrac{1}{2}k (\theta_4 - \theta_{4,0})^2  \\ 
	%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%% 
	A( \theta_2 ) &= \sum_{i=2}^4 ( m_i (\alpha_i^2 + \beta_i^2) + \gamma_i^2 J_i ).
\end{align}


The coupled dynamics of the DC motor with the FBM-SDF is given by combining  the
dynamic equation of the DC motor:
\begin{align}
	T_b &= nK_f i(t) - n^2 B \dot{\theta}_2 - n^2 J \ddot{\theta_2} \\
	L \dfrac{di(t)}{dt} + Ri(t) &= V_{in} (t) - nk_b \dot{\theta}_2
\end{align}
and
$$
	T = A( \theta_2 ) \ddot{\theta}_2 + \frac{1}{2} \dfrac{dA(\theta_2)}{d\theta_2}
	\dot{\theta}_2^2 + k \gamma_4 ( \theta_4 - \theta_{4,0} ) + C \gamma_4^2 \dot{\theta}_2
$$
% 
where
\begin{align}
	A(\theta_2) &=  C_0 + C_1 \gamma_3^2 + C_2 \gamma_4^2 + C_3 \gamma_3 \cos(\theta_2-\theta_3-\phi_3)\\
	\dfrac{dA(\theta_2)}{d\theta_2} &= 2C_1 \gamma_3 \dfrac{d \gamma_3}{d \theta_2} -2C_2 \gamma_4 \dfrac{d \gamma_4}{d \theta_2}.
	% 
\end{align}
$C_i,\ \dfrac{d \gamma_3}{d \theta_2}$ and $ \dfrac{d \gamma_4}{d \theta_2 } $ are
detailed in \cite{calva13}.
% 
Assume that $ \vec{x} = [x_1,x_2,x_3]^T = [ \theta_2, \dot{\theta}_2,i ]^T $ and
the input vector $u = V_{in}$, the coupled dynamics in a state space representation
of the DC motor with the FBM-SDF is given by:
\begin{align}
	\dot{x} &= f( \vec{x}, u(t), t ) \\
	&= 
	\begin{bmatrix}
		x_2\\
		A_0( x_2^2 + A_2 x_2 + nK_f x_3 + A_3 ]\\
		\dfrac{1}{L} (u(t) - n K_b x_2 - R x_3)
	\end{bmatrix}
\end{align}
% 
where
\begin{align}
	A_0 &= \dfrac{1}{A(x_1) + n^2 J_1} \\
	A_1 &= -\dfrac{1}{2} \dfrac{d}{A(x_1)}{dx_1} \\
	A_2 &= - (C \gamma_2^4 + n^2 B ) \\
	A_3 &= -k \gamma_4( \theta_4 - \theta_{4,0} ).
\end{align}

\subsection{Optimization Problem Definition} % (fold)
\label{sec:optimization_problem_definition}

In 2013, Calva-Y{\'a}{\~n}ez \cite{calva13} based its strategy on the work of Tao
and Sadler \cite{tao95}. The proposed control strategy is used in this work as well.
The controller is stated as follow:
%
%
\begin{equation}
	u(t) =  K_{p} e(t) \int\limits_{0}^{t} \dot{\theta}_2^d dt 
	   			+ K_I\int\limits_{0}^{t} e(t) dt + K_D \dot{e}(t),
\end{equation}
%
where $K_p$, $K_I$, $K_D$ is the proportional, integral and derivate gains, 
respectively. Here, $e(t) = \dot{\theta}_2^d - \dot{\theta}_2 $ and
$\dot{e}(t) = - \ddot{\theta}_2 $, with $\dot{\theta}_2^d$ the constant desired velocity. \\

The correct election of $K_p,\ K_d,\ K_I$ is important due to a bad selection of the PID
gains, the input velocity of the crank could be considerably affected. Thus, the
design variable vector is $ \vec{p} = [K_p,K_d,K_I]^T \in \mathbb{R}^3$, Note, $ \vec{p} $
includes the gains of the modified PID controller.\\

The dynamic optimization problem consists in finding the optimum design variables
$\vec{p} \in \mathbb{R}^3 $ such that:

\begin{equation}
	\min_{\vec{p} \in \mathbb{R}^2} F( \vec{p} ) 
	\label{eqn:minF}
\end{equation}
% 
subject to:
% 
% 
\begin{align}
	\label{eqn:mysystem}
	\dot{x}  & = f( \vec{x}, u( \vec{p},\ t ), t ) \\ \label{eqn:xDot}
	   u(t)  & = K_{p} e(t) \int\limits_{0}^{t} \dot{\theta}_2^d dt 
	   			+ K_I\int\limits_{0}^{t} e(t) dt + K_D \dot{e}(t) \\
  \vec{x}(0) & = x_0 \\
  g_1(\vec{x}) & \leq 0 \\
  g_2(\vec{x}) & \leq 0 \\
  p_{i,\min} & \leq p \leq p_{i,\min}, \label{eqn:pLims}
\end{align}
% 
%
with objective function defined for $t_0 = \min \{ t \in [0, t_f] \ | \ x_2(t) = \dot{\theta}_{2}^{\text{d}}  \}$:
\begin{equation}
	F( \vec{p} ) = \left| \max_{t\in [t_0,\ t_f]} x_2 (t) - \min_{t\in [t_0,\ t_f]}x_2(t) \right|, 
\end{equation}
% 
which may \textit{measure} the variation of the input velocity of the crank.
% 
If $F \to 0$, then $x_2(t) = \dot{\theta}_2(t)$ goes constant in $[t_0,\ t_f ]$. 
The first constraint is the solutions of the differential equation of the dynamic
model of the FBM-SDF choosing $x_0$ as the initial condition. This constraint
provide the dynamic behavior of the  system in the optimization problem. It is
necessary establish the rise time $t_r$ of the angular velocity of the crank
$ \dot{\theta}_2(t) < 0.1$ and the overshoot does not exceed of $1.7\%$ of the
desired angular velocity. Thus
\begin{align}
	g_1(t_r) &= t_r \leq 0.1s\\
	g_2(t_r) &= \dot{\theta}_2(t_r) \leq \dot{\theta_2^d} + 0.0017\dot{\theta}_2^d.
\end{align}
%
%

Next section present the performance of Algorithm \ref{algoritmoEca} solving the
constrained optimization problem (\ref{eqn:minF}) -- (\ref{eqn:pLims}).

\subsection{Experiments} % (fold)

To solve the dynamic optimization problem (\ref{eqn:minF}) -- (\ref{eqn:pLims}),
the close loop system (\ref{eqn:xDot}) is solved using the Runge-Kutta method
\cite{dormand80} with initial condition $x_0 = [0,0,0]^T$ with desired
velocity selected as $\theta_2^d = 30$ rad/s and the kinematic and dynamic parameters
of the coupled dynamics detailed in \cite{calva13}. The bounds of the design
variable vector is defined as $\vec{p} \in [0.1, \ 50]^3 \subset \mathbb{R}^3 $.\\

\subsection{Results} % (fold)
\label{sub:results}

Using the same experiment settings of Section \ref{sec:results1}, we use Algorithm 
\ref{algoritmoEca} for solving the dynamic optimization problem (\ref{eqn:minF}) -- (\ref{eqn:pLims}).
Here, the parameters where $\eta_{\max} = 4$, $K = 3$, $N = 10$, $\alpha = 100$
and max\_evals $=$ 10000.\\

Statistical results obtained in 31 independent runs by ECA and CHED are presented
in Table \ref{tab:res2}. No significant difference was found, based on the
90\%-confidence Wilcoxon test, which means that ECA obtain good results for this
kind of problems. Besides, Algorithm \ref{algoritmoEca} requires less evaluations
of objective function to get good results compared with a competitive state-art
evolutionary algorithm.\\


% subsection results (end)

\begin{table}[!ht]
	\centering
	\begin{tabular}{ccccccc}
		\hline
		& {\bf Evals.} & {\bf Best} & {\bf Median} & {\bf Mean} & {\bf Worst} & {\bf Std.} \\ \hline
		ECA & 10000 & 2.055877E--01 & 2.340816E--01 & 2.292241E--01 & 2.345938E--01 & 9.315045E--03 \\ \hline
		CHED & 20000 & 2.120037E--01 & 2.232873E--01 & 2.206308E--01 & 2.340816E--01 & 8.093537E--03 \\ \hline
	\end{tabular}
	\caption{Results of 31 independent runs of ECA on the dynamic optimization
	problem (\ref{eqn:minF}) -- (\ref{eqn:pLims}). Here, the feasibility ratio was 100\%.}
	\label{tab:res2}
\end{table}
% 
% 
% 
% 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.9\linewidth]{img/control.pdf}
	\begin{center}
		(A) \hspace{0.4\linewidth} (B)
	\end{center}
	\caption{(A) Shows the angular crank velocity with time (seconds) in [0.05, 2]
	with both approaches. (B) shows the behavior of the control signal obtained
	by the optimum design variable vector and with the experimental tuning.}
	\label{fig:tunning}
\end{figure}
% 
% 
% 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.8\linewidth]{img/control_zoom.pdf}
	\caption{Zoom of each respective graphic in Figure \ref{fig:tunning}. The
	rise time of the angular velocity of optimization approach is less than the
	experimental approach.}
	\label{fig:tunningZoom}
\end{figure}
% 
% \begin{figure}[!ht]
% 	\centering
% 	\includegraphics[width=0.8\linewidth]{img/control_median.pdf}
% 	\includegraphics[width=0.8\linewidth]{img/control_median_zoom.pdf}
% \end{figure}
% 
\begin{figure}[!ht]
	\centering
	\includegraphics[width=0.8\linewidth]{img/conv_control.pdf}
	\caption{Convergence at median of 31 independent runs. Note the fast convergence
	in this problem.}
	\label{fig:convMedian2}
\end{figure}

In Figure \ref{fig:tunning} (A) shows that the control signal of the manual
approach has a lower overshoot than the second approach to reach the reference
value of 30 rad/s.
% 
Finally, Algorithm \ref{algoritmoEca} was capable to converge fast (see Figure \ref{fig:convMedian2}),
which is convenient because this optimization problem is, relatively,
computationally expensive, since for each constraint evaluation, it is necessary
to solve the system of differential equations (\ref{eqn:mysystem}).

\section{Conclusion and Future Work} % (fold)
\label{sec:conclusion_and_future_work}

Physics-inspired Metaheuristic was presented ans used to solve engineering 
problems with promising results. ECA was capable to solve those problems using
less objective functions evaluations with equivalent results given by a 
competitive evolutionary algorithm.\\

Make a study to calibrate the parameters of Algorithm \ref{algoritmoEca} and study
others constraint handling methods to improve results. That are part of future work.\\

\noindent
The source code can be downloaded from
\verb|https://github.com/jmejia8/eca-four-bar-mechanisms|

% section conclusion_and_future_work (end)

% references
% \clearpage
\bibliographystyle{plain}
\bibliography{references}

\end{document}